<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>Deals Manager</title>

    <!-- App Configuration for iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Deals">
    <meta name="theme-color" content="#3B82F6">

    <!-- App Icon (180x180 for iOS) -->
    <link rel="apple-touch-icon" href="assets/AppIcon.appiconset/180.png">

    <!-- Startup Screen -->
    <link rel="apple-touch-startup-image"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 540 720'><rect fill='%23F8FAFC' width='540' height='720'/><rect fill='%233B82F6' width='540' height='120'/><text x='270' y='70' font-size='32' font-weight='700' fill='white' text-anchor='middle' font-family='system-ui'>Deals</text></svg>">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- External CSS Files -->
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/cards.css">
    <link rel="stylesheet" href="css/data.css">
    <link rel="stylesheet" href="css/modals.css">
    <link rel="stylesheet" href="css/empty-state.css">
    <link rel="stylesheet" href="css/responsive.css">


</head>

<body>

    <!-- Modal Dialog -->
    <div id="delete-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Remove from Saved?</h2>
                <p class="modal-description">This action cannot be undone.</p>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="closeDeleteModal()">Cancel</button>
                <button class="modal-btn modal-btn-delete" onclick="confirmDelete()">Remove</button>
            </div>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div id="logout-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Logout?</h2>
                <p class="modal-description">Are you sure you want to logout?</p>
            </div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="closeLogoutModal()">Cancel</button>
                <button class="modal-btn modal-btn-delete" onclick="logout()">Logout</button>
            </div>
        </div>
    </div> <!-- AUTH -->
    <div id="login-container">
        <div class="login-box">
            <h1>Deals Manager</h1>
            <p>Sign in to discover and save deals</p>
            <form onsubmit="login(event)">
                <input type="email" id="email" class="login-input" placeholder="Email" required />
                <input type="password" id="password" class="login-input" placeholder="Password" required />
                <button type="submit" class="btn-login">Sign In</button>
            </form>
        </div>
    </div>

    <!-- HEADER -->
    <header id="app-header" style="display:none;">
        <div class="header-top">
            <div class="app-title">Deals</div>
            <div class="deal-counter" id="deal-counter" style="display:none;">0 / 0</div>
            <div class="controls-row">
                <!-- VIEW TOGGLES -->
                <div class="view-toggles">
                    <button class="toggle-btn active" id="btn-card-view" onclick="switchViewMode('card')">
                        <!-- Card Icon -->
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
                            <line x1="8" y1="18" x2="16" y2="18"></line>
                        </svg>
                    </button>
                    <button class="toggle-btn" id="btn-table-view" onclick="switchViewMode('table')">
                        <!-- Table Icon -->
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="8" y1="6" x2="21" y2="6"></line>
                            <line x1="8" y1="12" x2="21" y2="12"></line>
                            <line x1="8" y1="18" x2="21" y2="18"></line>
                            <line x1="3" y1="6" x2="3.01" y2="6"></line>
                            <line x1="3" y1="12" x2="3.01" y2="12"></line>
                            <line x1="3" y1="18" x2="3.01" y2="18"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <div style="display:flex; gap:10px;">
            <select id="sort-select" class="sort-select" onchange="changeSort(this.value)">
                <option value="random">Shuffle</option>
                <option value="item_name">Item Name (A-Z)</option>
                <option value="name">Store (A-Z)</option>
                <option value="price_asc">Price (Low to High)</option>
                <option value="price_desc">Price (High to Low)</option>
                <option value="newest">Newest First</option>
            </select>
        </div>

        <div class="tabs">
            <button class="tab-btn active" id="tab-discover" onclick="switchTab('discover')">Discover</button>
            <button class="tab-btn" id="tab-saved" onclick="switchTab('saved')">Saved</button>
            <button class="logout-btn" id="logout-btn" onclick="confirmLogout()" title="Logout">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    style="width: 20px; height: 20px;">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
            </button>
        </div>
    </header>

    <!-- CONTENT -->
    <div id="main-container" style="display:none;">

        <!-- DETAIL VIEW OVERLAY -->
        <div id="detail-overlay" class="detail-overlay">
            <div class="detail-header">
                <div></div>
                <button class="detail-close-btn" onclick="closeDetailView()">âœ•</button>
            </div>
            <div class="detail-content" id="detail-content"></div>
            <div class="detail-actions">
                <button class="detail-btn detail-btn-reject" onclick="rejectFromDetail()">âœ• Not Interested</button>
                <button class="detail-btn detail-btn-save" onclick="saveFromDetail()">â™¥ Save Deal</button>
            </div>
        </div>

        <!-- DISCOVER VIEW -->
        <div id="discover-view">

            <!-- SUB-VIEW: CARD STACK -->
            <div id="discover-card-mode">
                <div class="stack-area">
                    <div id="card-stack">
                        <div id="empty-state">ðŸŽ‰ All caught up!</div>
                    </div>
                    <div class="empty-state-container" id="empty-state-container">
                        <div class="empty-state-icon">ðŸŽ‰</div>
                        <div class="empty-state-title">All Caught Up!</div>
                        <div class="empty-state-text" id="empty-state-message">You've reviewed all available deals.
                            Check back later for new listings.</div>
                        <button class="btn-refresh" id="refresh-btn" onclick="refreshDeals()">Refresh Deals</button>
                    </div>
                </div>
                <div class="actions-area">
                    <button class="circle-btn btn-nope" onclick="forceSwipe('left')">âœ•</button>
                    <button class="circle-btn btn-like" onclick="forceSwipe('right')">â™¥</button>
                </div>
            </div>

            <!-- SUB-VIEW: TABLE LIST -->
            <div id="discover-table-mode">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Details</th>
                            <th style="text-align:right">Price</th>
                            <th style="text-align:right">Action</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Rows go here -->
                    </tbody>
                </table>
            </div>

        </div>

        <!-- SAVED VIEW -->
        <div id="saved-view">
            <div id="saved-list"></div>
        </div>

    </div>

    <!-- External JavaScript Modules -->
    <script type="module" src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/swipe.js"></script>
</body>

</html>